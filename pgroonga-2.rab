= PGroonga 2

: subtitle
   Make PostgreSQL rich full text search system backend!
: author
   Kouhei Sutou
: institution
   ClearCode Inc.
: content-source
   PGConf.ASIA 2017
: date
   2017-12-05
: start-time
   2017-12-05T16:20:00+09:00
: end-time
   2017-12-05T17:00:00+09:00
: theme
   .

= Targets\n(('note:å¯¾è±¡è€…'))

  * Want to implement full text search with PostgreSQL\n
    (('note:PostgreSQLã§å…¨æ–‡æ¤œç´¢ã—ãŸã„'))
  * Not good at full text search\n
    (('note:å…¨æ–‡æ¤œç´¢ã¯ã‚ˆãçŸ¥ã‚‰ãªã„'))
  * PGroonga 1.0.0 users\n
    (('note:PGroonga 1.0.0ã¯ä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹'))

= Abbreviations\n(('note:ç•¥èª'))

  * PG: PostgreSQL\n
    (('note:ãƒã‚¹ã‚°ãƒ¬: PostgreSQL'))
  * FTS: Full text search\n
    (('note:FTS: å…¨æ–‡æ¤œç´¢'))

= FTS system: Targets\n(('note:å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ï¼šå¯¾è±¡'))

(('tag:center'))
(('tag:large'))
(('tag:margin-bottom * 2'))
Many tests\n
(('note:å¤§é‡ã®ãƒ†ã‚­ã‚¹ãƒˆ'))

  * e.g.: Text data in office docs in file servers\n
    (('note:ä¾‹ï¼šãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼å†…ã®ã‚ªãƒ•ã‚£ã‚¹æ–‡æ›¸å†…ã®ãƒ†ã‚­ã‚¹ãƒˆ'))
  * e.g.: Item descriptions, chat logs and so on\n
    (('note:ä¾‹ï¼šå•†å“èª¬æ˜ã‚„ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°ãªã©'))

= FTS system: Goal\n(('note:å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ï¼šç›®çš„'))

Provide\n
needed info\n
when you need\n
(('note:å¿…è¦ãªæƒ…å ±ã‚’å¿…è¦ãªã¨ãã«æä¾›ã™ã‚‹ã“ã¨'))

= Provide needed info\n(('note:å¿…è¦ãªæƒ…å ±ã‚’æä¾›'))

  * ğŸ˜ Not found\n
    (('note:æ¢ã—ã¦ã„ã‚‹æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‰ãªã„'))
  * ğŸ˜ƒ Found\n
    (('note:æ¢ã—ã¦ã„ã‚‹æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‹'))
  * ğŸ˜† Found ((*unconscious needed*)) info too!\n
    (('note:æ„è­˜ã—ã¦ã„ãªã‹ã£ãŸã‘ã©å®Ÿã¯æ¬²ã—ã‹ã£ãŸæƒ…å ±ã‚‚è¦‹ã¤ã‹ã‚‹ï¼'))

= When you need\n(('note:å¿…è¦ãªã¨ãã«æ´»ç”¨'))

  * ğŸ˜ Need many time to find\n
    (('note:ãªã‹ãªã‹è¦‹ã¤ã‹ã‚‰ãªã„'))
  * ğŸ˜ƒ Find in no time\n
    (('note:ã™ãã«è¦‹ã¤ã‹ã‚‹'))
  * ğŸ˜† Already found\n
    (('note:ã™ã§ã«è¦‹ã¤ã‹ã£ã¦ã„ãŸ'))
    * e.g.: Recommendation\n
      (('note:ä¾‹ï¼šãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³'))

= How to impl.: Options\n(('note:å®Ÿè£…æ–¹æ³•ï¼šé¸æŠè‚¢'))

  * Use FTS server\n
    (('note:å…¨æ–‡æ¤œç´¢ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ã†'))
  * Use PostgreSQL\n
    (('note:PostgreSQLã‚’ä½¿ã†'))

= FTS server: Pros\n(('note:å…¨æ–‡æ¤œç´¢ã‚µãƒ¼ãƒãƒ¼æ¡ˆï¼šãƒ¡ãƒªãƒƒãƒˆ'))

  * Provides all basic features\n
    (('note:å¿…è¦ãªæ©Ÿèƒ½ãŒæƒã£ã¦ã„ã‚‹'))
  * Provides advanced features\n
    (('note:ï¼‹Î±ã®æ©Ÿèƒ½ã‚‚ã‚ã‚‹'))
  * Fast\n
    (('note:é€Ÿã„'))

= FTS server: Cons1\n(('note:å…¨æ–‡æ¤œç´¢ã‚µãƒ¼ãƒãƒ¼æ¡ˆï¼šãƒ‡ãƒ¡ãƒªãƒƒãƒˆ1'))

  * Large implementation cost\n
    (('note:å®Ÿè£…ã‚³ã‚¹ãƒˆå¤§'))
    * Learn how to use from scratch\n
      (('note:ä½¿ã„æ–¹ã‚’1ã‹ã‚‰å­¦ã¶å¿…è¦ãŒã‚ã‚‹'))
    * How to impl. data sync?\n
      (('note:ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®åŒæœŸã¯ã©ã†ã™ã‚‹ï¼Ÿ'))

= FTS server: Cons2\n(('note:å…¨æ–‡æ¤œç´¢ã‚µãƒ¼ãƒãƒ¼æ¡ˆï¼šãƒ‡ãƒ¡ãƒªãƒƒãƒˆ2'))

  * Large maintenance cost\n
    (('note:ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆå¤§'))
    * Learn how to operate from scratch\n
      (('note:é‹ç”¨æ–¹æ³•ã‚’1ã‹ã‚‰å­¦ã¶å¿…è¦ãŒã‚ã‚‹'))

= PostgreSQL: Pros1\n(('note:PostgreSQLæ¡ˆï¼šãƒ¡ãƒªãƒƒãƒˆ1'))

  * Less implementation cost\n
    (('note:å®Ÿè£…ã‚³ã‚¹ãƒˆå°'))
    * Less things to be learned\n
      (('note:æ–°ã—ãè¦šãˆã‚‹ã“ã¨ãŒå°‘ãªã„'))
    * Can manage data at the same place\n
      (('note:ãƒ‡ãƒ¼ã‚¿ã®ä¸€å…ƒç®¡ç†'))

= PostgreSQL: Pros2\n(('note:PostgreSQLæ¡ˆï¼šãƒ¡ãƒªãƒƒãƒˆ2'))

  * Less operation cost\n
    (('note:ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆå°'))
    * The current operation knowledge is reusable\n
      (('note:æ—¢å­˜ã®é‹ç”¨ãƒã‚¦ãƒã‚¦ã‚’ä½¿ãˆã‚‹'))

= PostgreSQL: Cons\n(('note:PostgreSQLæ¡ˆï¼šãƒ‡ãƒ¡ãƒªãƒƒãƒˆ'))

  * Built-in features aren't enough\n
    (('note:çµ„è¾¼æ©Ÿèƒ½ã§ã¯æ©Ÿèƒ½ä¸è¶³'))
  * SQL limits efficiency\n
    (('note:SQLã®è¡¨ç¾åŠ›ä¸è¶³'))
    * e.g.: SQL needs multiple queries for a process that can be done by 1 query by FTS server\n
      (('note:ä¾‹ï¼šå…¨æ–‡æ¤œç´¢ã‚µãƒ¼ãƒãƒ¼ãªã‚‰1ã‚¯ã‚¨ãƒªãƒ¼ã§å®Ÿç¾ã§ãã‚‹å‡¦ç†ã«SQLã ã¨è¤‡æ•°ã‚¯ã‚¨ãƒªãƒ¼å¿…è¦ãªã“ã¨ãŒã‚ã‚‹'))

= The 3rd option\n(('note:ç¬¬3ã®é¸æŠè‚¢'))

  * Use FTS engine via PostgreSQL (SQL)\n
    (('note:PostgreSQLçµŒç”±ï¼ˆSQLï¼‰ã§å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½¿ã†'))

= Pros(('note:ãƒ¡ãƒªãƒƒãƒˆ'))

  * Fast and rich features\n
    (('note:é«˜é€Ÿã§è±Šå¯Œãªæ©Ÿèƒ½'))
  * Less implementation cost\n
    (('note:å®Ÿè£…ã‚³ã‚¹ãƒˆå°'))
  * Less operation cost\n
    (('note:ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆå°'))

= Cons\n(('note:ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ'))

  * Need PostgreSQL extension\n
    (('note:PostgreSQLã«æ‹¡å¼µæ©Ÿèƒ½ãŒå¿…è¦'))
    * Not available on DBaaS\n
      (('note:DBaaSã§ä½¿ãˆãªã„'))

= Option: No FTS knowledge\n(('note:ã‚ªã‚¹ã‚¹ãƒ¡ã®é¸æŠè‚¢ï¼šå…¨æ–‡æ¤œç´¢ã®çŸ¥è­˜ãƒŠã‚·'))

  * Need only simple features\n
    (('note:ã¾ã å˜ç´”ãªæ©Ÿèƒ½ã§ååˆ†'))
    * Less data: LIKE with PostgreSQL\n
      (('note:ãƒ‡ãƒ¼ã‚¿å°‘ï¼šPostgreSQLã§LIKE'))
  * Need up-to-date FTS features\n
    (('note:ã„ã¾ã©ãã®å…¨æ–‡æ¤œç´¢æ©Ÿèƒ½ãŒå¿…è¦'))
    * FTS engine via PostgreSQL\n
      (('note:PostgreSQLçµŒç”±ã§å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³'))

= Option: With FTS knowledge\n(('note:ã‚ªã‚¹ã‚¹ãƒ¡ã®é¸æŠè‚¢ï¼šå…¨æ–‡æ¤œç´¢ã®çŸ¥è­˜ã‚¢ãƒª'))

  * Need tuned FTS feature\n
    (('note:ã‚«ãƒªã‚«ãƒªã«ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ãŸã„'))
    * PostgreSQL + FTS server\n
      (('note:PostgreSQLï¼‹å…¨æ–‡æ¤œç´¢ã‚µãƒ¼ãƒãƒ¼'))
  * Others\n
    (('note:ãã‚Œä»¥å¤–'))
    * FTS engine via PostgreSQL\n
      (('note:PostgreSQLçµŒç”±ã§å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³'))

= Option to be described\n(('note:èª¬æ˜ã™ã‚‹é¸æŠè‚¢'))

FTS engine via\n
PostgreSQL\n
(('note:ostgreSQLçµŒç”±ã§å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³'))

= FTS engine: Groonga\n(('note:å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ï¼šGroongaï¼ˆãã‚‹ã‚“ãŒï¼‰'))

  * Embeddable FTS engine\n
    (('note:çµ„è¾¼å¯èƒ½ãªå…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³'))
    * PGroonga: Groonga in PostgreSQL\n
      (('note:PGroongaï¼šPostgreSQLã«çµ„è¾¼'))
  * Usable as FTS server\n
    (('note:å…¨æ–‡æ¤œç´¢ã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦å˜ç‹¬ã§ã‚‚ä½¿ç”¨å¯èƒ½'))
    * PostgreSQL + FTS server architecture is also available\n
      (('note:PostgreSQLï¼‹å…¨æ–‡æ¤œç´¢ã‚µãƒ¼ãƒãƒ¼æ§‹æˆã‚‚ã§ãã‚‹'))

= Groonga's hobby: data update\n(('note:Groongaã®å¾—æ„ãªäº‹ï¼šãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ãƒ»æ›´æ–°'))

  * Make fresh data searchable!\n
    (('note:æ–°é®®ãªæƒ…å ±ã‚’ã™ãæ¤œç´¢å¯èƒ½ï¼'))
    * Batch update is needless\n
      (('note:ãƒãƒƒãƒã§æ›´æ–°ã—ãªãã¦ã‚‚ã‚ˆã„'))
    * Can use as chat backend\n
      (('note:ãƒãƒ£ãƒƒãƒˆãã‚‰ã„ã®é »åº¦ã§ã‚‚OK'))\n
      e.g.: Zulip uses PGroonga\n
      (('note:ä¾‹ï¼šZulipã¯PGroongaã‚’æ¡ç”¨'))

= Groonga's hobby: data update\n(('note:Groongaã®å¾—æ„ãªäº‹ï¼šãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ãƒ»æ›´æ–°'))

  * Keep search performance while updating!\n
    (('note:æ›´æ–°ä¸­ã‚‚æ¤œç´¢æ€§èƒ½ãŒè½ã¡ãªã„ï¼'))
    * Updatable when there are many search users\n
      (('note:åˆ©ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¤šã„æ™‚ã§ã‚‚æ›´æ–°å¯èƒ½'))

= PGroonga\n(('note:PGroongaï¼ˆã´ãƒ¼ã˜ãƒ¼ã‚‹ã‚“ãŒï¼‰'))

  * PostgreSQL index\n
    (('note:PostgreSQLã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹'))
    * Alternative of GIN\n
      (('note:B-treeãƒ»GINãªã©ã¨åŒã˜ãƒ¬ã‚¤ãƒ¤ãƒ¼'))
  * Usage\n
    (('note:ä½¿ç”¨æ–¹æ³•'))
    * (({CREATE INDEX ...}))\n
      (({USING PGroonga ...}))

= PostgreSQL and FTS\n(('note:PostgreSQLã¨å…¨æ–‡æ¤œç´¢'))

  * LIKE: Built-in(('note:ï¼ˆçµ„è¾¼æ©Ÿèƒ½ï¼‰'))
  * textsearch: Built-in(('note:ï¼ˆçµ„è¾¼æ©Ÿèƒ½ï¼‰'))
  * pg_trgm: Contrib(('note:ï¼ˆæ¨™æº–æ·»ä»˜ï¼‰'))
    * Bundled in the archive\n
      (('note:ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã«ã¯å«ã¾ã‚Œã¦ã„ã‚‹'))
    * Need to install separately\n
      (('note:åˆ¥é€”ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚Œã°ä½¿ãˆã‚‹'))

= LIKE and performance\n(('note:LIKEã¨é€Ÿåº¦'))

  * Small data\n
    (('note:å°‘ãªã„ãƒ‡ãƒ¼ã‚¿'))
    * Enough performance\n
      (('note:ååˆ†å®Ÿç”¨çš„'))
    * 400 chars X 0.2M recs: < 1sec\n
      (('note:400æ–‡å­—Ã—20ä¸‡ä»¶ãã‚‰ã„ãªã‚‰1ç§’ã¨ã‹'))
  * Not small data\n
    (('note:å°‘ãªããªã„ãƒ‡ãƒ¼ã‚¿'))
    * Need to tune\n
      (('note:æ€§èƒ½å•é¡Œã‚¢ãƒª'))

= LIKE and FTS system\n(('note:LIKEã¨å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ '))

ğŸ‘Enough performance\n
in most case\n
(('note:é€Ÿåº¦ãŒå®Ÿç”¨çš„ãªã“ã¨ã‚‚å¤šã„'))

  * Data are small in many case\n
    (('note:å°‘ãªã„ãƒ‡ãƒ¼ã‚¿ãªã‚‰'))

= LIKE and FTS system\n(('note:LIKEã¨å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ '))

ğŸ‘Unable to sort\n
(('note:ãã‚Œã£ã½ã„é †ã®ã‚½ãƒ¼ãƒˆä¸å¯'))

  * Sort is important in FTS\n
    (('note:å…¨æ–‡æ¤œç´¢ã§ã¯ã‚½ãƒ¼ãƒˆé †ãŒé‡è¦'))
  * Users checks only\n
    the first N entries\n
    (('note:ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å…ˆé ­Nä»¶ã—ã‹è¦‹ãªã„'))

= textsearch

  * ğŸ‘Fast search by index\n
    (('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œã‚‹ã®ã§é€Ÿã„'))
  * Need module for each lang\n
    (('note:è¨€èªæ¯ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå¿…è¦'))
    * ğŸ‘Modules for English, French, ... are built-in\n
      (('note:è‹±èªã‚„ãƒ•ãƒ©ãƒ³ã‚¹èªãªã©ã¯çµ„è¾¼'))
    * ğŸ‘Modules for languages in Asia aren't maintained\n
      (('note:ã‚¢ã‚¸ã‚¢åœã®è¨€èªç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ãƒ¡ãƒ³ãƒ†ã•ã‚Œã¦ã„ãªã„'))

= pg_trgm

  * ğŸ‘Fast search by index\n
    (('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œã‚‹ã®ã§é€Ÿã„'))
  * ğŸ‘Asian languages aren't enough supported\n
    (('note:ã‚¢ã‚¸ã‚¢åœã®è¨€èªã®ã‚µãƒãƒ¼ãƒˆã¯ååˆ†ã§ã¯ãªã„'))
  * ğŸ‘Unable to sort\n
    (('note:ãã‚Œã£ã½ã„é †ã®ã‚½ãƒ¼ãƒˆä¸å¯'))

= PGroonga

  * ğŸ‘Fast search by index\n
    (('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œã‚‹ã®ã§é€Ÿã„'))
  * ğŸ‘Sortable\n
    (('note:ãã‚Œã£ã½ã„é †ã®ã‚½ãƒ¼ãƒˆå¯'))
  * ğŸ‘Support all languages\n
    (('note:å…¨è¨€èªå¯¾å¿œ'))
  * ğŸ‘Need to install separately\n
    (('note:åˆ¥é€”ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ã‚¢ãƒª'))

= FTS system with PostgreSQL\n(('note:PostgreSQLã§å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ '))

  * PGroonga is the best!ğŸ’¯\n
    (('note:PGroongaãŒãƒ™ã‚¹ãƒˆï¼'))
  * PGroonga
    * Fast(('note:ï¼ˆé«˜é€Ÿï¼‰'))
    * Support all langs(('note:ï¼ˆå…¨è¨€èªå¯¾å¿œï¼‰'))
    * Sortable(('note:ï¼ˆãã‚Œã£ã½ã„é †ã§ã‚½ãƒ¼ãƒˆå¯ï¼‰'))

= FTS system: Basic features\n(('note:å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ï¼šåŸºæœ¬æ©Ÿèƒ½'))

  * Fast FTS + sort\n
    (('note:é«˜é€Ÿå…¨æ–‡æ¤œç´¢ï¼‹ã‚½ãƒ¼ãƒˆ'))
  * Show texts around keyword\n
    (('note:ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‘¨è¾ºãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º'))
  * Highlight keyword\n
    (('note:æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆ'))

= FTS system: Adv. features\n(('note:å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ï¼šé«˜åº¦ãªæ©Ÿèƒ½'))

  * Auto complete\n
    (('note:ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ'))
  * Similar search\n
    (('note:é¡ä¼¼æ–‡æ›¸æ¤œç´¢'))
  * Synonym expansion\n
    (('note:åŒç¾©èªå±•é–‹'))

= PGroonga 1.0.0

(('tag:center'))
â†“ are only supported\n
(('note:ä»¥ä¸‹ã®æ©Ÿèƒ½ã®ã¿å¯¾å¿œ'))

  * Fast FTS + sort\n
    (('note:é«˜é€Ÿå…¨æ–‡æ¤œç´¢ï¼‹ã‚½ãƒ¼ãƒˆ'))
  * Show texts around keyword\n
    (('note:ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‘¨è¾ºãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º'))

= PGroonga 2

All features are supported!\n
(('note:å…¨æ©Ÿèƒ½å¯¾å¿œï¼'))

= PGroonga 1.0.0 â†’ 2

  * ğŸ˜† Many new features\n
    (('note:ãŸãã•ã‚“ã®æ–°æ©Ÿèƒ½'))
  * ğŸ˜† Improve performance\n
    (('note:æ€§èƒ½æ”¹å–„'))
  * ğŸ˜ API is changed\n
    (('note:APIãŒå¤‰ã‚ã£ãŸ'))

= API change\n(('note:APIå¤‰æ›´'))

(('tag:center'))
Operator is changed\n
(('note:æ¼”ç®—å­å¤‰æ›´'))

  @@ â†’ &@~
  %% â†’ &@
  ...

= API change\n(('note:APIå¤‰æ›´'))

(('tag:center'))
(({pgroonga})) schema is deprecated\n
(('note:pgroongaã‚¹ã‚­ãƒ¼ãƒã‚’éæ¨å¥¨ã«'))

  pgroonga.score â†’ pgroonga_score
  pgroonga.flush â†’ pgroonga_flush
  ...

= App for PGroonga 1.0.0\n(('note:PGroonga 1.0.0ç”¨ã‚¢ãƒ—ãƒª'))

  * Broken with PGroonga 2?\n
    (('note:PGroonga 2ã§ã¯å‹•ã‹ãªã„ï¼Ÿ'))
    * No! Work without any changes!\n
      (('note:ä½•ã‚‚å¤‰æ›´ã—ãªãã¦ã‚‚å‹•ãã‚ˆï¼'))

(('tag:center'))
Great! But why?\n
(('note:ã„ã„ã˜ã‚ƒã‚“ï¼ã§ã‚‚ãªã‚“ã§å‹•ãã®ï¼Ÿ'))\n
â†“\n
"Painless upgrade" technique

= Painless upgrade

  * PGroonga 2 provides\n
    both 1 API and 2 API\n
    (('note:PGroonag 2ã¯1ç”¨ã®APIã‚‚2ç”¨ã®APIã‚‚ä¸¡æ–¹æä¾›'))
    * Can use PGroonga 2 with 1 API\n
      (('note:PGroonga 1ã®APIã§PGroonag 2ã‚’ä½¿ãˆã‚‹'))

= Painless upgrade

  * PGroonga 2 keeps 1 API\n
    (('note:PGroonga 2ã®é–“ã¯1ã®APIã‚’ç¶­æŒ'))
  * PGroonga 3 will drop 1 API\n
    (('note:PGroonga 3ã§1ã®APIã‚’å‰Šé™¤äºˆå®š'))
    * Just need to upgrade API until 3\n
      (('note:PGroonga 3ã¾ã§ã«APIã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚Œã°ã‚ˆã„'))

= Painless upgrade

  * App for PGroonga 1.0.0 doesn't work with PGroonga 2\n
    (('note:PGroonga 1.0.0ç”¨ã®ã‚¢ãƒ—ãƒªãŒPGroonga 2ã§å‹•ã‹ãªã„'))
    * It's a bug. Please report it!\n
      (('note:ãƒã‚°ãªã®ã§å ±å‘Šã—ã¦ã­ï¼'))

= FTS system: Basic features\n(('note:å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ï¼šåŸºæœ¬æ©Ÿèƒ½'))

  * Fast FTS + sort\n
    (('note:é«˜é€Ÿå…¨æ–‡æ¤œç´¢ï¼‹ã‚½ãƒ¼ãƒˆ'))
  * Show texts around keyword\n
    (('note:ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‘¨è¾ºãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º'))
  * Highlight keyword\n
    (('note:æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆ'))

= Fast FTS + sort\n(('note:é«˜é€Ÿå…¨æ–‡æ¤œç´¢ï¼‹ã‚½ãƒ¼ãƒˆ'))

  # image
  # src = images/php-document-search-search.png
  # relative_height = 100

= Table definition

  # coderay sql

  CREATE TABLE entries (
    -- Need primary key
    -- It's needed for sort
    id integer PRIMARY KEY,
    title text,
    content text
  );

= Index definition

  # coderay sql

  -- For FTS.
  -- The default is good enough!
  CREATE INDEX entries_full_text_search
    ON entries
    -- "USING PGroonga" is important!
    -- Primary key is for sort!
    USING PGroonga (id, title, content);

= Insert data

  # coderay sql

  -- Normal INSERT.
  INSERT INTO entries
    VALUES (1,
            'Fast FTS with Groonga!',
            'Fast FTS is needed!');

= FTS

  # coderay sql

  SELECT title FROM entries
    WHERE
  -- &@~ is for FTS
  -- AND search with "search" and "fast"
      title &@~ 'search fast' OR
      content &@~ 'search fast';

= FTS: LIKE

  # coderay sql

  SELECT title FROM entries
    WHERE
  -- Index search for LIKE is supported
  -- = Improve app perf without any changes
  -- NOTE: &@~ is faster than LIKE
      title LIKE '%search%' OR
      content LIKE '%search%';

= Sort

  # coderay sql

  SELECT
      title,
      -- pgroonga_score(TABLE_NAME) returns
      -- precision as number
      pgroonga_score(entries) AS score
    FROM entries
    WHERE -- ...
    -- Sort by precision
    ORDER BY score DESC LIMIT 10;

= Highlight keyword\n(('note:ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆ'))

  # image
  # src = images/php-document-search-search.png
  # relative_height = 100

= Hightlight for HTML

  # coderay sql

  SELECT
    pgroonga_highlight_html(
      title,
      -- Extract keywords from query
      pgroonga_query_extract_keywords('search fast'))
    FROM entries
    WHERE title &@~ 'search fast' OR
          content &@~ 'search fast';

= Highlight for HTML: Example

  # coderay html

  Fast search with <Groonga>!
  â†“
  <span class="keyword">Fast</span>
  â†‘â†“ Keywords are marked up with "class"
  <span class="keyword">search</span>ï¼
  with &lt;Groonga&gt;! â† Escape tag

= Texts around keyword\n(('note:ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‘¨è¾ºãƒ†ã‚­ã‚¹ãƒˆ'))

  # image
  # src = images/php-document-search-search.png
  # relative_height = 100

= Texts around keyword for HTML

  # coderay sql

  SELECT
    pgroonga_snippet_html(
      content,
      -- Extract keywords from query
      pgroonga_query_extract_keywords('search fast'))
    FROM entries
    WHERE title &@~ 'search fast' OR
          content &@~ 'search fast';

= Example

  # coderay html

  ...fast search with <Groonga>!...
  â†“
  ARRAY[
    â†“ First
    '<span class="keyword">fast</span>
    â†‘â†“ Keywords are marked up with "class"
    <span class="keyword">search/span>ï¼
    with &lt;Groonga&gt;!', â† Escape tag
    '...' â† Second
  ]

= FTS system: Adv. features\n(('note:å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ï¼šé«˜åº¦ãªæ©Ÿèƒ½'))

  * Auto complete\n
    (('note:ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ'))
  * Similar search\n
    (('note:é¡ä¼¼æ–‡æ›¸æ¤œç´¢'))
  * Synonym expansion\n
    (('note:åŒç¾©èªå±•é–‹'))

= Auto complete\n(('note:ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ'))

  # image
  # src = images/php-document-search.png
  # relative_height = 100

= Auto complete: Preparation\n(('note:ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼šæº–å‚™'))

  * Master table\n
    (('note:ãƒã‚¹ã‚¿ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«'))
    * Candidate\n
      (('note:å€™è£œï¼šï¼ˆä¾‹ï¼šç‰›ä¹³ï¼‰'))
    * Readings in Katakana\n
      (Only for Japanese)\n
      (('note:ãƒ¨ãƒŸï¼ˆæ—¥æœ¬èªã®å ´åˆã€‚ã‚«ã‚¿ã‚«ãƒŠã€‚è¤‡æ•°ç™»éŒ²å¯ã€‚ï¼‰'))
      * (('note:ä¾‹ï¼šã‚®ãƒ¥ã‚¦ãƒ‹ãƒ¥ã‚¦ãƒ»ãƒŸãƒ«ã‚¯'))

= Auto complete: Implementation\n(('note:ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼šå®Ÿè£…æ–¹æ³•'))

  * OR search with ...
    * Prefix search against readings\n
      (Only for Japanese)\n
      (('note:ãƒ¨ãƒŸã‚’å‰æ–¹ä¸€è‡´æ¤œç´¢ï¼ˆæ—¥æœ¬èªã®å ´åˆã€‚ï¼‰'))
    * Loose FTS against candidate\n
      (('note:å€™è£œã‚’ç·©ãå…¨æ–‡æ¤œç´¢'))
  * Sort by candidate\n
    (('note:å€™è£œã§ã‚½ãƒ¼ãƒˆ'))

(('tag:xx-small'))
((<"https://pgroonga.github.io/how-to/auto-complete.html"|URL:https://pgroonga.github.io/how-to/auto-complete.html>))

= Table definition

  # coderay sql

  CREATE TABLE terms (
    -- Candidate
    term text,
    -- Readings
    readings text[],
  );

= Data example

  # coderay sql

  INSERT INTO terms VALUES (
    'milk', -- Candidate
    ARRAY[
     -- Reading in Katakana
     'ã‚®ãƒ¥ã‚¦ãƒ‹ãƒ¥ã‚¦', -- "milk" in Japanese
     -- Multiple readings
     'ãƒŸãƒ«ã‚¯'        -- "milk" in Katakana
    ]
  );

= Data management\n(('note:ãƒ‡ãƒ¼ã‚¿ç®¡ç†'))

  * Easy to maintain because it's a normal table\n
    (('note:æ™®é€šã®ãƒ†ãƒ¼ãƒ–ãƒ«ãªã®ã§ç®¡ç†ãŒæ¥½'))
    * Easy to insert/delete/update\n
      (('note:è¿½åŠ ãƒ»å‰Šé™¤ãƒ»æ›´æ–°ãŒæ¥½'))
    * Normal backup and replication\n
      (('note:ãƒ€ãƒ³ãƒ—ãƒ»ãƒªã‚¹ãƒˆã‚¢ã‚‚ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ã„ã¤ã‚‚é€šã‚Š'))

= Index for prefix search\n(('note:å‰æ–¹ä¸€è‡´ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹'))

  # coderay sql

  CREATE INDEX prefix_search ON terms
    USING PGroonga
    -- ...text_array_term_search...
    (readings pgroonga_text_array_term_search_ops_v2);

= Index for loose FTS\n(('note:ç·©ã„å…¨æ–‡æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹'))

  # coderay sql

  CREATE INDEX loose_search ON terms
    USING PGroonga (term)
    -- Tokenizer for loose full text search
    WITH (tokenizer='TokenBigramSplitSymbolAlphaDigit');

= How to search\n(('note:æ¤œç´¢æ–¹æ³•'))

  # coderay sql

  SELECT term FROM terms
  -- Prefix search against readings
    WHERE readings &^~ '${INPUT}' OR
  -- Loose full text search
          term &@ '${INPUT}'
    ORDER BY term LIMIT 10; -- Sort

= Search example: Candidate\n(('note:æ¤œç´¢ä¾‹ï¼šå€™è£œ'))

  # coderay sql

  -- User inputs "il"
  SELECT term FROM terms
  -- Prefix search against readings
    WHERE readings &^~ 'il' OR
  -- Loose full text search (Hit)
          term &@ 'li'
    ORDER BY term LIMIT 10; -- Sort

= Search example: Katakana\n(('note:æ¤œç´¢ä¾‹ï¼šã‚«ã‚¿ã‚«ãƒŠ'))

  # coderay sql

  -- User inputs "ã‚®ãƒ¥ã‚¦"
  SELECT term FROM terms
  -- Prefix search against readings (Hit)
    WHERE readings &^~ 'ã‚®ãƒ¥ã‚¦' OR
  -- Loose full text search (Hit)
          term &@ 'ã‚®ãƒ¥ã‚¦'
    ORDER BY term LIMIT 10; -- Sort

= Search example: Hiragana\n(('note:æ¤œç´¢ä¾‹ï¼šã²ã‚‰ãŒãª'))

  # coderay sql

  -- User inputs "ãã‚…ã†"
  SELECT term FROM terms
  -- Prefix search against readings (Hit)
    WHERE readings &^~ 'ãã‚…ã†' OR
  -- Loose full text search
          term &@ 'ãã‚…ã†'
    ORDER BY term LIMIT 10; -- Sort

= Search example: Romaji\n(('note:æ¤œç´¢ä¾‹ï¼šãƒ­ãƒ¼ãƒå­—'))

  # coderay sql

  -- User inputs "gyu"
  SELECT term FROM terms
  -- Prefix search against readings (Hit)
    WHERE readings &^~ 'gyu' OR
  -- Loose full text search
          term &@ 'gyu'
    ORDER BY term LIMIT 10; -- Sort

= Synonym expansion\n(('note:åŒç¾©èªå±•é–‹'))

  * Synonym\n
    (('note:åŒç¾©èª'))
    * Same mean but different notation\n
      (('note:åŒã˜æ„å‘³ã ãŒè¡¨è¨˜ãŒç•°ãªã‚‹èª'))
    * e.g.: "PostgreSQL" and "PG"\n
      (('note:ä¾‹ï¼šã€ŒPostgreSQLã€ã¨ã€Œãƒã‚¹ã‚°ãƒ¬ã€'))

= Synonym expansion\n(('note:åŒç¾©èªå±•é–‹'))

  * Users don't want to care\n
    (('note:ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ°—ã«ã—ãŸããªã„'))
  * Synonym expansion\n
    (('note:åŒç¾©èªå±•é–‹'))
    * OR search with all synonyms\n
      (('note:åŒç¾©èªã™ã¹ã¦ã§ORæ¤œç´¢'))

= Implementation\n(('note:å®Ÿè£…æ–¹æ³•'))

  * Create synonym table\n
    (('note:åŒç¾©èªç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ'))
  * Expand synonyms in query\n
    (('note:ã‚¯ã‚¨ãƒªãƒ¼å†…ã®åŒç¾©èªã‚’å±•é–‹'))
  * Search by expanded query\n
    (('note:å±•é–‹å¾Œã®ã‚¯ã‚¨ãƒªãƒ¼ã§æ¤œç´¢'))

(('tag:xx-small'))
((<"https://pgroonga.github.io/reference/functions/pgroonga-query-expand.html"|URL:https://pgroonga.github.io/reference/functions/pgroonga-query-expand.html>))

= Table definition

  # coderay sql
  CREATE TABLE synonyms (
    -- Term to be expanded
    term text,
    -- Synonym list.
    -- Including the "term" itself.
    -- If you don't input the "term",
    -- the "term" is unsearchable term.
    terms text[]
  );

= Data example

  # coderay sql
  INSERT INTO synonyms
    VALUES ('PostgreSQL', -- Expand "PostgreSQL"
            ARRAY['PostgreSQL', 'PG']),
           ('PG', -- Expand "PG"
            ARRAY['PG', 'PostgreSQL']);

= Data management\n(('note:ãƒ‡ãƒ¼ã‚¿ç®¡ç†'))

  * Easy to maintain because it's a normal table\n
    (('note:æ™®é€šã®ãƒ†ãƒ¼ãƒ–ãƒ«ãªã®ã§ç®¡ç†ãŒæ¥½'))
    * Easy to insert/delete/update\n
      (('note:è¿½åŠ ãƒ»å‰Šé™¤ãƒ»æ›´æ–°ãŒæ¥½'))
    * Normal backup and replication\n
      (('note:ãƒ€ãƒ³ãƒ—ãƒ»ãƒªã‚¹ãƒˆã‚¢ã‚‚ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ã„ã¤ã‚‚é€šã‚Š'))

= Index definition

  # coderay sql
  CREATE INDEX synonym_search ON synonyms
    USING PGroonga
    -- ...text_term_search...
    -- For equal search
    (term pgroonga_text_term_search_ops_v2);

= Confirm\n(('note:ç¢ºèªæ–¹æ³•'))

  # coderay sql

  SELECT pgroonga_query_expand(
    'synonyms', -- Table name
    'term', -- Column name to be expanded
    'terms', -- Column name for synonyms
    'PostgreSQL' -- Query
  );
  -- '((PostgreSQL) OR (PG))'

= Search\n(('note:æ¤œç´¢æ–¹æ³•'))

  # coderay sql
  SELECT title FROM entries
    WHERE
   -- title &@~ 'DB ((PostgreSQL) OR (PG))'
      title &@~
        pgroonga_query_expand('synonyms',
                              'term',
                              'terms',
                              'DB PostgreSQL');

= Similar search\n(('note:é¡ä¼¼æ–‡æ›¸æ¤œç´¢'))

  * Query is document itself\n
    (('note:æ¤œç´¢ã‚¯ã‚¨ãƒªãƒ¼ã¯æ–‡æ›¸ãã®ã‚‚ã®'))
    * Not keyword\n
      (('note:ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ã¯ãªã„'))
  * Use case\n
    (('note:åˆ©ç”¨ä¾‹'))
    * Show related entries\n
      (('note:é–¢é€£ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã®æç¤ºã«ä½¿ãˆã‚‹'))

= Implementation\n(('note:å®Ÿç¾æ–¹æ³•'))

  * Create dedicated index\n
    (('note:é¡ä¼¼æ¤œç´¢ç”¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œã‚‹'))
    * Use tokenizer for target language\n
      (('note:å¯¾è±¡ã®è¨€èªã«åˆã‚ã›ãŸå‡¦ç†ã§ç²¾åº¦å‘ä¸Š'))
    * e.g.: MeCab based tokenizer for Japanese\n
      (('note:ä¾‹ï¼šæ—¥æœ¬èªãªã‚‰MeCabãƒ™ãƒ¼ã‚¹ã®ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã‚’æ´»ç”¨'))
  * Use dedicated operator\n
    (('note:é¡ä¼¼æ¤œç´¢ç”¨ã®æ¼”ç®—å­ã‚’ä½¿ã†'))

= Index definition

  # coderay sql

  CREATE INDEX entries_similar_search
    ON entries
    -- Target: Both title and content
    -- Reason: Title is important
    USING PGroonga (id, (title || ' ' || content))
    -- TokenMecab is good for Japanese
    WITH (tokenizer='TokenMecab');

= Search

  # coderay sql

  SELECT title,
      pgroonga_score(entries) AS score
    FROM entries
    WHERE
      -- &@* is operator for similar search.
      -- Search with existing document.
      (title || ' ' || content) &@*
        '...fast search with Groonga!...'
    ORDER BY score DESC LIMIT 3;

= Result example\n(('note:çµæœä¾‹'))

  Query:
     ...search with Groonga!...

  Hit example:
     ...search with PGroonga!...

= Wrap up: Basic features\n(('note:å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ï¼šåŸºæœ¬æ©Ÿèƒ½'))

  * Fast FTS + sort\n
    (('note:é«˜é€Ÿå…¨æ–‡æ¤œç´¢ï¼‹ã‚½ãƒ¼ãƒˆ'))
  * Show texts around keyword\n
    (('note:ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‘¨è¾ºãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º'))
  * Highlight keyword\n
    (('note:æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆ'))

= Wrap up: Adv. features\n(('note:å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ï¼šé«˜åº¦ãªæ©Ÿèƒ½'))

  * Auto complete\n
    (('note:ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ'))
  * Similar search\n
    (('note:é¡ä¼¼æ–‡æ›¸æ¤œç´¢'))
  * Synonym expansion\n
    (('note:åŒç¾©èªå±•é–‹'))

= å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…\næ¬¡ã®ä¸€æ­©

  * æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿å¯¾å¿œ
    * ã‚ªãƒ•ã‚£ã‚¹æ–‡æ›¸ãƒ»HTMLãªã©
  * å¯¾å¿œã«å¿…è¦ãªå‡¦ç†
    * ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
    * ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡º(('note:ï¼ˆä¾‹ï¼šã‚¿ã‚¤ãƒˆãƒ«ãƒ»æ›´æ–°æ—¥æ™‚ï¼‰'))
    * ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä½œæˆ(('note:ï¼ˆãªãŠã‚ˆã„ï¼‰'))

= æŠ½å‡ºãƒ„ãƒ¼ãƒ«

  * Apache Tika
    * Apache Luceneã®ã‚µãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
    * å¯¾å¿œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ•°ãŒå¤šã„
  * ChupaText
    * Groongaã®ã‚µãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
    * ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä½œæˆå¯¾å¿œ

= ChupaText

  * å¯¾å¿œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    * Word/Excel/PowerPoint
    * ODT/ODS/ODP(('note:ï¼ˆOpenDocumentï¼‰'))
    * PDF/HTML/XML/CSV/...
  * ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹
    * HTTPã¨ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³

= ChupaTextï¼šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

  * Dockerã‹Vagrantã‚’ä½¿ã†ã®ãŒæ¥½
    * (('tag:xx-small'))
      ((<"https://github.com/ranguba/chupa-text-docker"|URL:https://github.com/ranguba/chupa-text-docker>))
    * (('tag:xx-small'))
      ((<"https://github.com/ranguba/chupa-text-vagrant"|URL:https://github.com/ranguba/chupa-text-vagrant>))

= ChupaTextï¼šDocker

  # coderay console
  % GITHUB=https://github.com
  % git clone \
     ${GITHUB}/ranguba/chupa-text-docker.git
  % cd chupa-text-docker
  % docker-compose up --build

= ChupaTextï¼šä½¿ã„æ–¹

  # coderay console
  % curl \
      --form data=@XXX.pdf \
      http://localhost:20080/extraction.json

= ChupaTextï¼šçµæœä¾‹

  # coderay json

  {
    "mime-type": "application/pdf", # å…ƒãƒ‡ãƒ¼ã‚¿ã®MIMEã‚¿ã‚¤ãƒ—
    "size": 147159, # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    ...,
    "texts": [ # æŠ½å‡ºã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆï¼ˆNå€‹ï¼‰
      {
        "mime-type": "text/plain", # æŠ½å‡ºå¾Œã®MIMEã‚¿ã‚¤ãƒ—
        ...,
        "creator": "Adobe Illustrator CS3", # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
        "body": "This is sample PDF. ...", # æŠ½å‡ºã—ãŸãƒ†ã‚­ã‚¹ãƒˆ
        "screenshot": {
          "mime-type": "image/png", # ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®MIMEã‚¿ã‚¤ãƒ—
          "data": "iVBORw...", # Base64ã«ã—ãŸç”»åƒãƒ‡ãƒ¼ã‚¿
          "encoding": "base64" # Base64ã§ã‚ã‚‹ã“ã¨ã‚’æ˜è¨˜
        }
      }
    ]
  }

= ChupaTextï¼šWeb UI

  # image
  # src = images/chupa-text-web-ui-form.png
  # relative_height = 100

= ChupaTextï¼šWeb UIæŠ½å‡ºä¾‹

  # image
  # src = images/chupa-text-web-ui-extract-metadata.png
  # relative_height = 100

= ChupaTextï¼šWeb UIæŠ½å‡ºä¾‹

  # image
  # src = images/chupa-text-web-ui-extract-text-and-screenshot.png
  # relative_height = 100

= ChupaTextï¼šVagrant

  # coderay console
  % GITHUB=https://github.com
  % git clone \
     ${GITHUB}/ranguba/chupa-text-vagrant.git
  % cd chupa-text-vagrant
  % vagrant up

(('tag:center'))
ä½¿ã„æ–¹ã¯Dockerç‰ˆã¨åŒã˜

= ChupaTextï¼šæ´»ç”¨ä¾‹

  * æŠ½å‡ºã—ãŸãƒ†ã‚­ã‚¹ãƒˆ
    * PGroongaã¸æŒ¿å…¥
  * æŠ½å‡ºã—ãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    * PGroongaã¸æŒ¿å…¥
    * çµã‚Šè¾¼ã¿ã«æ´»ç”¨
  * ä½œæˆã—ãŸã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
    * æ¤œç´¢çµæœè¡¨ç¤ºæ™‚ã«æ²è¼‰

= ã¾ã¨ã‚

  * PostgreSQLçµŒç”±ã§\n
    å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³
    * æ¡ç”¨ã®åˆ¤æ–­ææ–™ã‚’æä¾›
  * å…¨æ–‡æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ä¾‹ã‚’ç´¹ä»‹
    * PGroonga
  * æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®å¯¾å¿œæ–¹æ³•ã‚’ç´¹ä»‹
    * ChupaText

= æ‰±ã‚ãªã‹ã£ãŸè©±é¡Œ

  * é‹ç”¨ã«ã¤ã„ã¦
    * éšœå®³å¯¾ç­–ãƒ»ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
    * ãƒ­ã‚¸ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯\n
      å¯¾å¿œæ¸ˆã¿ï¼(('note:ï¼ˆå°‘ã—ã ã‘è¨­å®šæ–¹æ³•ã‚’ç´¹ä»‹ï¼‰'))
  * ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
  * Groongaã®æ©Ÿèƒ½ã‚’ç›´æ¥ä½¿ã†æ–¹æ³•

= ãƒ­ã‚¸ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³\npostgresql.conf

  # coderay conf
  # ãƒã‚¹ã‚¿ãƒ¼
  wal_level = logical
  max_wal_senders = 10
  max_replication_slots = 10

= ãƒ­ã‚¸ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³\nDBä½œæˆãƒ»PGroongaã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

  # coderay sql
  -- ãƒã‚¹ã‚¿ãƒ¼
  CREATE DATABASE test_master;
  \c test_master
  CREATE EXTENSION pgroonga;

= ãƒ­ã‚¸ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³\nãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

  # coderay sql
  -- ãƒã‚¹ã‚¿ãƒ¼
  CREATE TABLE memos (
    id integer PRIMARY KEY,
    content text
  );
  CREATE INDEX
    full_text_search_index ON memos
    USING pgroonga (id, content);

= ãƒ­ã‚¸ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³\nãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ

  # coderay sql
  -- ãƒã‚¹ã‚¿ãƒ¼
  -- pg_hba.confã‚‚ç·¨é›†ã™ã‚‹ã“ã¨
  CREATE ROLE replica
    WITH REPLICATION
      LOGIN PASSWORD 'pass';
  GRANT SELECT
    ON ALL TABLES IN SCHEMA public
    TO replica;

= ãƒ­ã‚¸ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³\npublicationä½œæˆ

  # coderay sql
  -- ãƒã‚¹ã‚¿ãƒ¼
  CREATE PUBLICATION pub
    FOR TABLE memos;

= ãƒ­ã‚¸ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³\nDBä½œæˆãƒ»PGroongaã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

  # coderay sql
  -- ã‚¹ãƒ¬ãƒ¼ãƒ–
  CREATE DATABASE test_slave;
  \c test_slave
  CREATE EXTENSION pgroonga;

= ãƒ­ã‚¸ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³\nãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

  # coderay sql
  -- ã‚¹ãƒ¬ãƒ¼ãƒ–
  CREATE TABLE memos (
    id integer PRIMARY KEY,
    content text
  );
  CREATE INDEX
    full_text_search_index ON memos
    USING pgroonga (id, content);

= ãƒ­ã‚¸ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³\nsubscriptionä½œæˆ

  # coderay sql
  -- ã‚¹ãƒ¬ãƒ¼ãƒ–
  CREATE SUBSCRIPTION sub
    CONNECTION
      'host=192.168.0.18 port=5432
       user=replica password=pass
       dbname=test_master'
    PUBLICATION pub;

= ãƒ­ã‚¸ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³\nç¢ºèª

  # coderay sql
  -- ãƒã‚¹ã‚¿ãƒ¼
  INSERT INTO memos VALUES (1, 'å…¨æ–‡æ¤œç´¢');
  -- ã‚¹ãƒ¬ãƒ¼ãƒ–
  SELECT * FROM memos
    WHERE content &@~ 'å…¨æ–‡æ¤œç´¢';
  --  id | content  
  -- ----+----------
  --   1 | å…¨æ–‡æ¤œç´¢
  -- (1 row)

= ã‚µãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹ç´¹ä»‹

  * å°å…¥æ”¯æ´(('note:ï¼ˆè¨­è¨ˆæ”¯æ´ãƒ»æ€§èƒ½æ¤œè¨¼ãƒ»ç§»è¡Œæ”¯æ´ãƒ»â€¦ï¼‰'))
  * é–‹ç™ºæ”¯æ´\n
    (('note:ï¼ˆã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰æä¾›ãƒ»å•ã„åˆã‚ã›å¯¾å¿œãƒ»â€¦ï¼‰'))
  * é‹ç”¨æ”¯æ´(('note:ï¼ˆéšœå®³å¯¾å¿œãƒ»ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°æ”¯æ´ãƒ»â€¦ï¼‰'))

å•ã„åˆã‚ã›å…ˆï¼š

(('tag:x-small'))
((<"https://www.clear-code.com/contact/?type=groonga"|URL:https://www.clear-code.com/contact/?type=groonga>))
